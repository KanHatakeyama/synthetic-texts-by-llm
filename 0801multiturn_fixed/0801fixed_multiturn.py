# %%
# %%
import time
import os
from datetime import datetime
from vllm import SamplingParams, LLM
import json
import random
from genre_list import genre_list
import re
import sys
args = sys.argv

"""
export CUDA_VISIBLE_DEVICES=0
conda activate llmeval
nohup python 0801fixed_multiturn.py  &

export CUDA_VISIBLE_DEVICES=0
nohup python 0801fixed_multiturn.py &

export CUDA_VISIBLE_DEVICES=1
nohup python 0801fixed_multiturn.py &

export CUDA_VISIBLE_DEVICES=2
nohup python 0801fixed_multiturn.py &

export CUDA_VISIBLE_DEVICES=3
nohup python 0801fixed_multiturn.py &

export CUDA_VISIBLE_DEVICES=4
nohup python 0801fixed_multiturn.py &

export CUDA_VISIBLE_DEVICES=5
nohup python 0801fixed_multiturn.py &

export CUDA_VISIBLE_DEVICES=6
nohup python 0801fixed_multiturn.py &

export CUDA_VISIBLE_DEVICES=7
nohup python 0801fixed_multiturn.py &

"""


def get_longest_phrase_length(text):
    # 区切り文字として、スペース、カンマ、句読点、改行を指定
    delimiters = r'[ ,。！？、\n]'
    # テキストを区切り文字で分割
    try:
        phrases = re.split(delimiters, text)
        # 最大のフレーズの長さを取得
        max_length = max(len(phrase) for phrase in phrases)
    except:
        max_length = 9999
    return max_length


def is_abnormal_text(text, threshold=40):
    words = text.split()
    word_count = len(words)
    # 複数の区切り文字をカウント
    period_count = text.count('.') + text.count(',') + \
        text.count('､') + text.count('｡')
    ratio = word_count / period_count if period_count > 0 else word_count
    return ratio > threshold


n_turns = 2
batch_size = 50
out_dir = "0802out"
# out_dir = "0724multiturn_oum"

pid = os.getpid()
seed = int(pid)+int(datetime.now().timestamp())
print("seed: ", seed)
random.seed(seed)


os.system(f"mkdir -p {out_dir}")

current_time_no_symbols = datetime.now().strftime(
    "%Y-%m-%d %H:%M:%S").replace("-", "").replace(":", "").replace(" ", "")
out_path = f"{out_dir}/model_{current_time_no_symbols}_{random.randint(0,10000)}.jsonl"


# %%

model_name = "cyberagent/calm3-22b-chat"
tensor_parallel_size = 1
llm = LLM(model=model_name, trust_remote_code=True,
          max_model_len=4000,
          # max_model_len=7000,
          #  gpu_memory_utilization=0.9,
          tensor_parallel_size=tensor_parallel_size,
          )


def llm_gen(llm, prompt_list, temperature=0.7, top_k=50):

    outputs = llm.generate(
        prompt_list,
        sampling_params=SamplingParams(
            temperature=temperature,
            max_tokens=1024,
            repetition_penalty=1.2,
            top_k=top_k,
        )
    )
    return [i.outputs[0].text.strip() for i in outputs]


# %%
def question_to_prompt(question, role, history=[]):
    prompt = f"""<|im_start|>system
{role}
<|im_end|>"""

    if len(history) > 0:
        for q, a in history:
            prompt += f"""<|im_start|>user
{q}<|im_end|>
<|im_start|>assistant
{a}<|im_end|>"""
    prompt += f"""<|im_start|>user
{question}<|im_end|>
<|im_start|>assistant"""
    return prompt


# %%
jobs = """会社員
公務員
自営業
医師
看護師
エンジニア
デザイナー
教師
販売員
サービス業
農業従事者
漁業従事者
建設業従事者
製造業従事者
運送業従事者
金融業従事者
保険業従事者
不動産業従事者
IT関連業従事者
コンサルタント
作家
アーティスト
ミュージシャン
俳優
タレント
スポーツ選手
研究者
学生
主婦/主夫
無職
"""
job_list = jobs.split("\n")
job_list = [i for i in job_list if i != ""]

character_text = """感情的知性が高い
責任感が強い
創造的である
同情的である
好奇心が強い
優れたコミュニケーション能力を持つ
論理的思考ができる
適応能力が高い
勤勉である
強い倫理観を持つ
協力的である
細部にまで注意を払う
問題解決能力が高い
楽観的である
情熱的である
適度な自信を持つ
誠実である
客観的である
オープンマインドである
ユーモアのセンスがある
粘り強い
文化的敏感性を持つ
忍耐強い
積極的である
革新的な考え方をする
リーダーシップの素質を持つ
巻き返す能力がある
多様性を尊重する
チームプレーヤーである
謙虚である
規律性がある
迅速な対応ができる
良心的な判断をする
気配りができる
他人への敬意を払う
楽観的な見通しを持つ
自制心がある
信頼に足る
機転が利く
分析的である
積極的に学ぶ姿勢を持つ
親切である
献身的である
思いやりがある
積極的である
仕事への熱意がある
創造性に富む
熱心である
尊敬に値する
倫理観が高い
革新的なアイディアを出す
戦略的思考ができる
思いやりのある
洞察力がある
尊大な態度がない
情熱的である
積極的な姿勢を持つ
細かい配慮ができる
信頼できる
社交的である
独立心がある
常に向上心を持つ
率先して行動する
強い意志を持つ
決断力がある
思いやりの心を持つ
積極的に問題解決にあたる
創造的なアイディアを提案する
積極的に知識を習得する
親しみやすい
積極的にコミュニケーションを取る
率先して課題に取り組む
積極的に新しいことに挑戦する
強いリーダーシップを発揮する
常に学ぶ姿勢を忘れない
積極的にチームに貢献する
細かいところにも気を配る
積極的に意見を述べる
積極的に課題解決にあたる
積極的に新しいスキルを習得する
積極的にチームワークを発揮する
積極的に問題解決に挑む
積極的に新しいアイディアを出す
積極的に新しいチャレンジをする
強い責任感を持つ
細かいところにも気を配る
積極的に新しい技術を学ぶ
積極的に新しい環境に適応する
強い意志を持って物事に取り組む
積極的に新しい経験をする
荒々しい
性格の悪い
細かい
気難しい
"""
character_list = character_text.split("\n")
character_list = [i for i in character_list if i != ""]

response_text = """「このように、」で始めて、3つの名詞を使って結論を述べてください。
「この点を考慮して、」で始めて、2つの比喩を使って提案を述べてください。
「これにより、」で始めて、3つの名詞を使って結果を説明してください。
「そのためには、」で始めて、3つの名詞を含めた具体例で説明してください。
「それでは、」で始めて、3つの名詞を含めた例え話で説明してください。
「ちなみに、」で始めて、箇条書きで事実を述べてください。
「とはいえ、」で始めて、2つの隠喩を用いて異なる視点を示してください。
「まず第一に、」で始めて、3つの名詞を使った説明をしてください。
「また、」で始めて、箇条書きで追加の情報を提供してください。
「もう一つの見方は、」で始めて、箇条書きで異なる意見を示してください。
「一言で言えば、」で締めくくり、2つの比喩を使って説明してください。
「一方では、」で始めて、箇条書き形式で対比を説明してください。
「具体的に言えば、」で始めて、4つの形容詞を使い、比喩的な表現で説明してください。
「結果として、」で締めくくり、4つの形容詞を使って効果を述べてください。
「結局のところ、」で締めくくり、4つの形容詞を使って感想を述べてください。
「結論としては、」で締めくくり、2つの隠喩を使って説明してください。
「最後に、」で締めて、4つの形容詞を使ってまとめてください。
「次に、」で始めて、2つの比喩を用いて説明してください。
「要するに、」で締めくくり、4つの形容詞を使って要約してください。
「例えば、」で始めて、箇条書き形式で具体的な例を挙げてください。
アクティブな動詞を使って、もっとダイナミックに表現してください。
あなたの応答を、「期待感を持たせる言葉で終える」ようにしてください。
あなたの応答を、「敬意を表す言葉で締めくくる」ようにしてください。
あなたの応答を、「結論から始める」ようにしてください。
あなたの応答を、「丁寧な言葉遣い」に変えてください。
あなたの応答を、「挑戦的な言葉で締めくくって」ください。
あなたの応答を、「反対意見を述べる形」に変えてください。
あなたの応答を、「未来の視点から見た」表現にしてください。
あなたの応答を、4つの形容詞を使って、「結果として、」で締めてください。
あなたの応答を、4つの形容詞を使って、「結局のところ、」で締めてください。
あなたの応答を、4つの形容詞を使って、「最後に、」で締めてください。
あなたの応答を、4つの形容詞を使って、「要するに、」で締めくくってください。
あなたの応答を、定性的な観察に基づいて評価し、5つのデータポイントでJSON形式で書き出してください（単語のはじめは常に大文字にしてください）。
あなたの応答を、定性的な観察に基づいて評価し、5つのデータポイントでJSON形式で書き出してください。
あなたの応答を、定性的な観察に基づいて評価し、JSON形式で書き出してください。
あなたの応答を、定性的な観察に基づいて評価してください。
あなたの応答を、定性的な観点から解釈し、5つの要素でYAML形式で書き出してください（全て小文字で書いてください）。
あなたの応答を、定性的な観点から解釈し、5つの要素でYAML形式で書き出してください。
あなたの応答を、定性的な観点から解釈し、YAML形式で書き出してください。
あなたの応答を、定性的な観点から解釈してください。
あなたの応答を、定性的な視点から見直し、3つの項目で箇条書きでまとめてください（全て大文字で書いてください）。
あなたの応答を、定性的な視点から見直し、3つの項目で箇条書きでまとめてください。
あなたの応答を、定性的な視点から見直し、箇条書きでまとめてください。
あなたの応答を、定性的な視点から見直してください。
あなたの応答を、定性的な分析に変えて、3つのポイントでJSON形式で書き出してください（単語のはじめは常に大文字にしてください）。
あなたの応答を、定性的な分析に変えて、3つのポイントでJSON形式で書き出してください。
あなたの応答を、定性的な分析に変えて、JSON形式で書き出してください。
あなたの応答を、定性的な分析に変えてください。
あなたの応答を「たとえば、」で始めて、250文字以内で物語的な表現を用いてください。
あなたの応答を「とはいえ、」で始めて、150文字以内で比較を使って説明してください。
あなたの応答を「もう一つの見方は、」で始めて、300文字以内でアナロジーを用いてください。
あなたの応答を「逆に、」で始めて、対比を使って説明してください。
あなたの応答を定性的な観点から分析し、YAML形式で5つの要素に書き出してください（全て小文字で書いてください）。
あなたの応答を定性的に評価し、3つのポイントでJSON形式で書き出してください（単語のはじめは常に大文字にしてください）。
あなたの応答を批判的な視点から見直し、3つの項目に箇条書きでまとめてください（全て大文字で書いてください）。
あなたの応答を批判的な視点から評価し、5つのデータポイントでJSON形式で書き出してください（単語のはじめは常に大文字にしてください）。
あなたの回答に、3つの名詞を含めて、「それでは、」で始めてください。
あなたの回答に「一言で言えば、」というフレーズを挿入し、150文字以内で説明してください。
あなたの回答の一部を、「驚きの感情を込めた言い回し」に変えてください。
あなたの回答を、「もっと簡潔に短く」してください。
あなたの回答を、「ユーモアを交えて」表現してください。
あなたの回答を、「引用で締めくくる」ようにしてください。
あなたの回答を、「感謝の気持ちを表現する形」に変えてください。
あなたの回答を、「感謝の言葉で締めくくって」ください。
あなたの回答を、「疑問を投げかける形」にしてください。
あなたの回答を、「驚きの言葉で始める」形にしてください。
あなたの回答を、「具体的な例から始めて」ください。
あなたの回答を、「肯定的な表現」に変えてください。
あなたの回答を、「物語のように書き出して」みてください。
あなたの回答を、「話し言葉」で書き出してみてください。
あなたの回答を、2つの隠喩を使って、「とはいえ、」で始めてください。
あなたの回答を、2つの隠喩を使って、「結論としては、」で締めてください。
あなたの回答を、2つの比喩を使って、「この点を考慮して、」で始めてください。
あなたの回答を、2つの比喩を使って、「一言で言えば、」で締めくくってください。
あなたの回答を、2つの比喩を使って、「次に、」で始めてください。
あなたの回答を、箇条書き形式で定量的な評価に書き換えてください。
あなたの回答を、感想や意見を交えて定性的に評価し、4つの要素でYAML形式で整理してください（全て小文字で書いてください）。
あなたの回答を、感想や意見を交えて定性的に評価し、4つの要素でYAML形式で整理してください。
あなたの回答を、感想や意見を交えて定性的に評価し、YAML形式で整理してください。
あなたの回答を、感想や意見を交えて定性的に評価してください。
あなたの回答を、定性的なフィードバックに書き換えて、2つの部分でJSON形式で出力してください（単語のはじめは常に大文字にしてください）。
あなたの回答を、定性的なフィードバックに書き換えて、2つの部分でJSON形式で出力してください。
あなたの回答を、定性的なフィードバックに書き換えて、JSON形式で出力してください。
あなたの回答を、定性的なフィードバックに書き換えてください。
あなたの回答を、定性的な感想に変更し、2つの項目で箇条書きで整理してください（全て大文字で書いてください）。
あなたの回答を、定性的な感想に変更し、2つの項目で箇条書きで整理してください。
あなたの回答を、定性的な感想に変更し、箇条書きで整理してください。
あなたの回答を、定性的な感想に変更してください。
あなたの回答を、定性的な表現に変更し、4つの項目で箇条書きにしてください（全て大文字で書いてください）。
あなたの回答を、定性的な表現に変更し、4つの項目で箇条書きにしてください。
あなたの回答を、定性的な表現に変更し、箇条書きで整理してください。
あなたの回答を、定性的な表現に変更してみてください。
あなたの回答を、定性的な評価に置き換えて、6つの要素でYAML形式で整理してください（全て小文字で書いてください）。
あなたの回答を、定性的な評価に置き換えて、6つの要素でYAML形式で整理してください。
あなたの回答を、定性的な評価に置き換えて、YAML形式で整理してください。
あなたの回答を、定性的な評価に置き換えてください。
あなたの回答を、定量的な評価に書き換えて、3つの項目に箇条書きしてください（全て大文字で書いてください）。
あなたの回答を、定量的な評価に書き換えて、3つの項目に箇条書きしてください。
あなたの回答を、定量的な評価に書き換えてください。
あなたの回答を「さらに、」で始めて、150文字以内で具体的な例を含めてください。
あなたの回答を「それでは、」で始めて、200文字以内で表現してください。
あなたの回答を「まず第一に、」で始めて、隠喩を使って説明してください。
あなたの回答を「結論としては、」で始めて、感情を込めて締めくくってください。
あなたの回答を「最初に、」で始めて、比喩的な表現を交えて150文字以内にしてください。
あなたの回答を感情を交えて定性的に評価し、YAML形式で4つの要素に整理してください（全て小文字で書いてください）。
あなたの回答を定性的なフィードバックに書き換え、2つの部分でJSON形式で出力してください（単語のはじめは常に大文字にしてください）。
あなたの回答を定性的な感想に変更し、2つの項目に箇条書きで整理してください（全て大文字で書いてください）。
あなたの回答を定性的な評価に置き換え、YAML形式で6つの要素に整理してください（全て小文字で書いてください）。
あなたの回答を定量的に評価し、3つの指標を用いて箇条書きで示してください（全て大文字で書いてください）。
あなたの回答を批判的な視点から評価し、4つの要素に箇条書きで整理してください（全て大文字で書いてください）。
あなたの先ほどの回答を「か」で始まる文章に変えてください。
あなたの先ほどの回答を「も」で始まる文にしてください。
あなたの先ほどの答えを「ふ」で始める文に変えてください。
あなたの前の回答を「ね」で始めるように書き直してください。
あなたの前の答えを「な」で始めてください。
あなたの直前の応答を「し」で始まる文にリライトしてください。
あなたの直前の答えを「せ」で始まる文にリライトしてください。
アナロジーを使って、複雑な概念を簡単に説明してみてください。
イメージしやすい表現に置き換えて、もっと親しみやすくしてみてください。
イメージや感覚に訴える言葉で、情緒豊かにしてみてください。
イメージや感覚を引き出す言葉を使って、情感豊かに表現してみてください。
イメージや感覚を喚起する言葉で、もっと情感豊かに表現してみて。
イメージや感覚を喚起する言葉を使って、もっと情感豊かに表現してみて。
イメージや感覚を喚起する言葉を用いて、より情感豊かに表現してみてください。
インスピレーションを与えるような言葉で、心を動かしてください。
エピソードを交えて、親しみやすくしてください。
コメディタッチで、ユーモアを交えて軽快にしてください。
コントラストを強調して、違いを明確にしてください。
シチュエーションを設定して、具体的な場面を想像させてください。
シリアスなトーンで、真剣に伝えてみてください。
シンプルな言葉に変えて、わかりやすくしてください。
シンボルを使って、象徴的な表現にしてみてください。
パラドックスを用いて、興味を引き出してみてください。
ポジティブな言葉で、前向きな印象を与えてください。
もっと効果的な表現を考えて、伝わりやすくしてみてください。
もっと分かりやすく伝えるために、別の表現を試してみてください。
ユーモアを交えて、楽しく伝えてみてください。
よりインパクトを持たせるために、別の表現を考えてください。
より印象的に伝えるために、別の表現方法を考えてみてください。
より印象的に伝えるために、別の表現方法を考えてみよう。
より効果的な表現方法を考えて、より伝わりやすく言い換えてみてください。
より分かりやすく伝えるために、別の表現方法を試してみてください。
リーダブルなスタイルで、読みやすく整理してみてください。
主語を省略してみてください。
主語を「人々」にしてください。
主語を「誰か」にしてみてください。
受動態を避けて、能動態にしてください。
丁寧な言葉遣いで書いてください。
カジュアルな言葉遣いにしてみてください。
質問形式で書き直してください。
肯定的な表現にしてみてください。
否定的な表現にしてみてください。
「もし～ならば」の形で書いてください。
「...のように」の表現を使って例え話にしてください。
「...のため」を使って理由を説明してください。
感情を込めた表現にしてみてください。
主語を「私たち」にしてください。
主語を「君」にしてください。
主語を「彼ら」にしてください。
主語を「彼女たち」にしてください。
主語を「それ」にしてください。
主語を「もの」にしてください。
主語を「あなたたち」にしてください。
主語を「我々」にしてください。
主語を「人々」にしてください。
受動態を能動態にしてください。
敬語を使ってください。
カジュアルな口調にしてください。
主観的な表現にしてください。
客観的な表現にしてください。
肯定的な表現にしてください。
否定的な表現にしてください。
率直な言葉遣いにしてください。
遠回しな言い方にしてください。
結論を先に述べてください。
結論を後に述べてください。
「です・ます」調にしてください。
「である」調にしてください。
簡潔に要点をまとめてください。
具体例を使って説明してください。
リーダビリティを向上させるために箇条書きにしてください。
事実を強調してください。
意見を強調してください。
視覚的に説明してください。
感覚的に説明してください。
感情を交えて説明してください。
感情を抑えて説明してください。
具体的な数値を用いて説明してください。
「?とは限らない」という表現を使ってください。
反論の余地がないようにしてください。
相手の意見を尊重する表現にしてください。
相手の意見に反論する表現にしてください。
対比を使って説明してください。
結論を曖昧にしてください。
結論を明確にしてください。
理由を詳しく説明してください。
理由を省略してください。
背景情報を加えて説明してください。
背景情報を省略してください。
話の順序を変えてください。
話の流れをそのままにしてください。
一つの例に絞って説明してください。
複数の例を挙げて説明してください。
視点を変えて説明してください。
異なる視点を取り入れて説明してください。
主観的な視点から説明してください。
客観的な視点から説明してください。
直前の回答に追加情報を加えてください。
直前の回答を短くしてください。
直前の回答を長くしてください。
直前の回答を分かりやすくしてください。
直前の回答を複雑にしてください。
他のアプローチで説明してください。
結論を変えてください。
理由を変えてください。
直前の回答に反論してください。
直前の回答に同意してください。
直前の回答に疑問を呈してください。
直前の回答を肯定的に評価してください。
直前の回答を否定的に評価してください。
リズム感のある表現で、耳に心地よく響かせてください。
直前の回答を3つの名詞で表現してください。
3つの動詞を使って直前の回答を説明してください。
直前の答えを2つの形容詞で表現してください。
5つの名詞を使って直前の回答を要約してください。
4つの動詞で直前の回答を説明してください。
直前の回答を1つの名詞にまとめてください。
直前の回答を2つの副詞で説明してください。
直前の回答を3つの形容詞で要約してください。
直前の答えを5つの名詞で表現してください。
2つの名詞で直前の回答を要約してください。
2つの形容詞で直前の回答を説明してください。
直前の答えを1つの形容詞で表現してください。
5つの動詞を使って直前の回答を説明してください。
直前の回答を4つの形容詞で説明してください。
直前の答えを2つの名詞で要約してください。
3つの形容詞で直前の回答を表現してください。
4つの名詞を使って直前の答えを要約してください。
5つの名詞で直前の答えを説明してください。
直前の答えを2つの動詞で説明してください。
3つの副詞を使って直前の答えを要約してください。
わかりやすさを重視して、別の言い回しを試してみてください。
異なる視点から考えて、新たな表現方法を試してみてください。
異なる表現を用いて、隠喩的に言い換えてみてください。
異なる文体やスタイルを試して、魅力的に表現してみてください。
引用を使って、信憑性を高めてください。
隠喩や換喩などの修辞法を用いて、より効果的に伝える方法を考えてみてください。
隠喩や換喩を活用して、もっと効果的に伝えてみてください。
隠喩や換喩を使って、もっと効果的な伝え方を考えてみて。
隠喩や換喩を使って、もっと効果的に伝える方法を考えてみて。
隠喩や換喩を使って、伝わりやすく工夫してみてください。
映画のシーンのように、劇的に演出してみてください。
音楽に例えて、感覚的に伝えてみてください。
回想シーンのように、過去の出来事を振り返るようにしてください。
絵画のように描写して、視覚的なイメージを作り出してください。
感覚に訴える言葉で、もっと情緒的に伝えてみてください。
感謝の気持ちを込めて、暖かみのある言葉にしてみてください。
感情を込めて、もっと印象に残るようにしてください。
擬音語を使って、臨場感を出してみてください。
擬人化して、より親しみやすく説明してみてください。
疑問形を使って、考えを引き出すようにしてみてください。
議論を巻き起こすような表現で、活発な討論を促してください。
緊張感を持たせて、ドラマチックな効果を狙ってください。
具体的な数字やデータを示して、説得力を持たせてください。
具体例を挙げて、より理解しやすく説明してください。
形象的な言葉で言い換えて、より印象深く表現してみてください。
形象的な言葉で表現し直して、印象深くしてみてください。
形象的な言葉に言い換えて、もっと印象に残るようにしてみよう。
言葉や言い回しを工夫して、表現を多様化してみてください。
古典的な表現を使って、格式を感じさせてください。
視覚的なイメージを活用して、具体的に描写してください。
視点を変えて、異なる角度から再考してみてください。
詩的な表現で、感動を引き起こすようにしてみてください。
先ほどの答えに、「具体的な数字」を入れてください。
先ほどの答えに、「詳細な具体例」を追加してください。
先ほどの答えを、「アナロジー（例え話）」を使って説明してください。
先ほどの答えを、「警告の言葉で締める」ようにしてください。
先ほどの答えを、「質問で始める」ようにしてください。
先ほどの答えを、「質問形」にしてもう一度表現してください。
先ほどの答えを、「推測で締めくくる」ように書き直してください。
先ほどの答えを、「反問から始める」形に変えてください。
先ほどの答えを、「否定的な表現」にしてみてください。
先ほどの答えを、「批判的な視点で」書き直してください。
先ほどの答えを、「励ましの言葉で終える」ようにしてみてください。
先ほどの答えを、3つの名詞を含めて、「このように、」で始めてください。
先ほどの答えを、3つの名詞を含めて、「これにより、」で始めてください。
先ほどの答えを、3つの名詞を含めて、「そのためには、」で始めてください。
先ほどの答えを、3つの名詞を含めて、「まず第一に、」で始めてください。
先ほどの答えを、4つの形容詞を使って、「具体的に言えば、」で始めてください。
先ほどの答えを、具体的な数値を挙げて定量的に説明し、4つの項目で箇条書きで示してください（全て大文字で書いてください）。
先ほどの答えを、具体的な数値を挙げて定量的に説明し、4つの項目で箇条書きで示してください。
先ほどの答えを、具体的な数値を挙げて定量的に説明し、箇条書きで示してください。
先ほどの答えを、具体的な数値を挙げて定量的に説明してください。
先ほどの答えを、定性的な評価に変えて、YAML形式で2つの要素に分けて出力してください（全て小文字で書いてください）。
先ほどの答えを、定性的な評価に変えて、YAML形式で2つの要素に分けて出力してください。
先ほどの答えを、定性的な評価に変えて、YAML形式で出力してください。
先ほどの答えを、定性的な評価に変えて説明してください。
先ほどの答えを、定量的なデータを含めて、YAML形式で6つのセクションに分けて説明してください（全て小文字で書いてください）。
先ほどの答えを、定量的なデータを含めて、YAML形式で6つのセクションに分けて説明してください。
先ほどの答えを、定量的なデータを含めて、YAML形式で説明してください。
先ほどの答えを、定量的なデータを含めて説明してください。
先ほどの答えを、定量的な結果を用いて、5つのデータポイントでJSON形式で説明してください（単語のはじめは常に大文字にしてください）。
先ほどの答えを、定量的な結果を用いて、5つのデータポイントでJSON形式で説明してください。
先ほどの答えを、定量的な結果を用いて、JSON形式で説明してください。
先ほどの答えを、定量的な結果を用いて説明してください。
先ほどの答えを、定量的な証拠を用いて強化し、4つのセクションでYAML形式で出力してください（全て小文字で書いてください）。
先ほどの答えを、定量的な証拠を用いて強化し、4つのセクションでYAML形式で出力してください。
先ほどの答えを、定量的な証拠を用いて強化し、YAML形式で出力してください。
先ほどの答えを、定量的な証拠を用いて強化してください。
先ほどの答えを「ここで重要なのは、」で始めて、250文字以内で感情的な表現を使ってください。
先ほどの答えを「このように、」で締めくくり、100文字以内で要約してください。
先ほどの答えを「まず、」で始めて、100文字以内で簡潔に説明してください。
先ほどの答えを「結果として、」で始めて、200文字以内で具体例を含めて説明してください。
先ほどの答えを「例えば、」で始めて、比喩を使って説明してください。
先ほどの答えを具体的な数値を挙げて定量的に評価し、箇条書きで4つの項目を示してください（全て大文字で書いてください）。
先ほどの答えを定性的な評価に変えて、YAML形式で2つの観点から出力してください（全て小文字で書いてください）。
先ほどの答えを定量的なデータを基に評価し、YAML形式で6つのセクションに分けて説明してください（全て小文字で書いてください）。
先ほどの答えを定量的な結果で支持し、5つのデータポイントでJSON形式で説明してください（単語のはじめは常に大文字にしてください）。
先ほどの答えを定量的な証拠で強化し、YAML形式で4つのセクションに分けて出力してください（全て小文字で書いてください）。
先端技術に例えて、現代的な視点から説明してみてください。
専門用語を避けて、一般的な言葉で説明してみてください。
前回の応答を、「過去形」で表現してください。
前回の応答を、「事実の引用から始める」ように書き直してください。
前回の応答を、「第三者の立場からの視点」に変えてみてください。
前回の応答を、箇条書き形式で「例えば、」で始めて説明してください。
前回の応答を、具体的な数値を使って定量的に評価し、5つの項目でJSON形式で示してください（単語のはじめは常に大文字にしてください）。
前回の応答を、具体的な数値を使って定量的に評価し、5つの項目でJSON形式で示してください。
前回の応答を、具体的な数値を使って定量的に評価し、JSON形式で示してください。
前回の応答を、具体的な数値を使って定量的に評価してください。
前回の応答を「つまり、」で締めくくり、感情的な表現を加えてください。
前回の応答を「よ」で始める文にしてみてください。
前回の応答を具体的な数値で定量的に評価し、5つの項目にまとめてJSON形式で示してください（単語のはじめは常に大文字にしてください）。
前回の答えに、「専門用語を使わずに」説明してください。
前回の答えを、「過去の出来事と比較して」説明してください。
前回の答えを、「感情を込めて」表現してください。
前回の答えを、「感嘆詞で始める」ように書き換えてください。
前回の答えを、「疑問形で始める」ようにしてください。
前回の答えを、「問いかけで終わる」ようにしてみてください。
前回の答えを、「問題提起で始める」形に変えてください。
前回の答えを、箇条書き形式で「ちなみに、」で始めて説明してください。
前回の答えを、箇条書き形式で「また、」で始めて説明してください。
前回の答えを、箇条書き形式で「もう一つの見方は、」で始めて説明してください。
前回の答えを、箇条書き形式で「一方では、」で始めて説明してください。
前回の答えを、数値データに基づいて定量的に評価し、3つのポイントでJSON形式で示してください（単語のはじめは常に大文字にしてください）。
前回の答えを、数値データに基づいて定量的に評価し、3つのポイントでJSON形式で示してください。
前回の答えを、数値データに基づいて定量的に評価し、JSON形式で示してください。
前回の答えを、数値データに基づいて定量的に評価してください。
前回の答えを、数値で具体的に表現する定量的な評価にし、2つの項目で箇条書きにしてください（全て大文字で書いてください）。
前回の答えを、数値で具体的に表現する定量的な評価にし、2つの項目で箇条書きにしてください。
前回の答えを、数値で具体的に表現する定量的な評価にし、箇条書きにしてください。
前回の答えを、数値で具体的に表現する定量的な評価にしてください。
前回の答えを、数値や統計を使用して定量的に評価し、6つのセクションでYAML形式で記述してください（全て小文字で書いてください）。
前回の答えを、数値や統計を使用して定量的に評価し、6つのセクションでYAML形式で記述してください。
前回の答えを、数値や統計を使用して定量的に評価し、YAML形式で記述してください。
前回の答えを、数値や統計を使用して定量的に評価してください。
前回の答えを、定量的なメトリクスを使用して説明し、3つの項目で箇条書きで示してください（全て大文字で書いてください）。
前回の答えを、定量的なメトリクスを使用して説明し、3つの項目で箇条書きで示してください。
前回の答えを、定量的なメトリクスを使用して説明し、箇条書きで示してください。
前回の答えを、定量的なメトリクスを使用して説明してください。
前回の答えを「それでは、」で始めて、感情を込めた形象的な表現で終えてください。
前回の答えを「と」で始まるように書き換えてください。
前回の答えを「驚くべきことに、」で始めて、隠喩を用いて説明してください。
前回の答えを「最後に、」で締めくくり、具体的な数字を使ってください。
前回の答えを「実際には、」で始めて、200文字以内で具体例を挙げてください。
前回の答えを数値データに基づいて定量的に評価し、3つのポイントでJSON形式で示してください（単語のはじめは常に大文字にしてください）。
前回の答えを数値で具体的に評価し、2つの項目に箇条書きでまとめてください（全て大文字で書いてください）。
前回の答えを定量的なデータを使って評価し、YAML形式で6つのセクションに整理してください（全て小文字で書いてください）。
前回の答えを定量的なメトリクスを使って説明し、箇条書きで3つの項目を示してください（全て大文字で書いてください）。
対比を用いて、ポイントを際立たせてください。
対話形式で、会話のように説明してみてください。
短いフレーズに分けて、情報を整理して伝えてみてください。
抽象的なアイデアを具体的な例で補強して、理解を深めてください。
抽象的な概念を具体的なイメージに置き換えて、わかりやすく伝えてください。
抽象的な概念を具体的なイメージに置き換えて説明してみてください。
抽象的な概念を具体的なイメージに変えて、わかりやすく説明してみてください。
抽象的な概念を具体的なイメージに変えて、説明してみてください。
抽象的な概念を具体的なイメージに変えて説明してみて。
抽象的な概念を具体的な事例に落とし込み、理解しやすくしてください。
抽象的な概念を具体的な例にして、もっと分かりやすくしてみて。
抽象的な概念を具体的な例にして、もっと分かりやすくしてみてください。
抽象的な概念を具体的な例に落とし込んで、より分かりやすく説明してみてください。
直前の回答を「は」で始まる文に変更してください。
哲学的な視点から、深い意味を持たせてください。
比喩を活用して、より記憶に残るようにしてみてください。
比喩を駆使して、創造性を発揮してみてください。
比喩を使って、もっとわかりやすく表現してみてください。
比喩を使って、もっと創造的でユニークにしてみて。
比喩を使って、もっと創造的でユニークに表現してみてください。
比喩を使って、もっと豊かで印象的な言葉にしてみて。
比喩を使って、もっと豊かな表現に変えてみてください。
比喩的な表現で、もっとクリエイティブでユニークにしてみてください。
比喩的な表現を使って、もっと印象に残るようにしてみてください。
比喩的な表現を使って、もっと印象に残るようにしてみよう。
比喩的な表現を使って、もっと豊かで印象的な言葉に変えてみて。
比喩的な表現を用いて、より印象的で記憶に残るようにしてみてください。
比喩的な表現を用いて、より印象的で記憶に残る形に変えてみてください。
比喩的な表現を用いて、より創造的でユニークな形に変えてみてください。
比喩的な表現を用いて、より豊かで印象的な言葉に変換してみてください。
比喩表現を多用して、生き生きとした表現にしてみてください。
表現方法を工夫して、もっと伝わりやすくしてみてください。
風景を描写するように、イメージを引き出してみてください。
物語を組み立てるように、順序立てて説明してみてください。
物語風にして、よりドラマチックにしてみてください。
別のアプローチで、隠喩を使って表現を変えてみてください。
別の言葉や言い回しで、もっと多彩に表現してみよう。
別の言葉や言い回しを用いて、より多彩に表現してみてください。
別の表現で、隠喩的に言い換えてみてください。
別の表現を使って、隠喩的に言い換えてみてください。
別の表現を用いて、隠喩的に言い換えてみてください。
別の文体やスタイルで、もっと魅力的に表現してみてください。
別の文体やスタイルを用いて、より魅力的に表現してみてください。
豊かで印象的な言葉に変えてみてください。
未来の視点から、将来を見据えた表現を試みてください。
問題提起して、考えさせるような表現にしてみてください。
例え話やアナロジーで、もっと分かりやすく説明してみてください。
例え話やアナロジーで、わかりやすさを増してみてください。
例え話やアナロジーを使って、もっと分かりやすく説明してください。
例え話やアナロジーを使って、もっと分かりやすく説明してみて。
例え話やアナロジーを用いて、より分かりやすく説明してみてください。
歴史的な例を挙げて、納得しやすくしてください。
「結論として、」で始めて、誤りがあれば正し、結果を再評価してください。
「この結果を踏まえて、」で始めて、2つの定量的なデータを使って評価をしてください。
「振り返りとして、」で始めて、3つの要因を分析し、修正の提案をしてください。
「分析の結果、」で始めて、正確さを評価し、誤りを指摘してください。
「この観点から見て、」で始めて、反省点と改善点を定性的に述べてください。
「もう一度見直してみると、」で始めて、2つの定量的なエビデンスを用いて評価してください。
「最後に、」で始めて、定性的な感想と評価をまとめてください。
「このデータに基づいて、」で始めて、具体的な数値を使って誤りを修正してください。
「考察として、」で始めて、定量的な分析結果を反省点としてまとめてください。
「再評価すると、」で始めて、誤りや不足点を具体的な例で示してください。
「全体の観点から見ると、」で始めて、問題点を特定し改善案を提案してください。
「結論に基づいて、」で始めて、誤りを修正し、定性的な見解を述べてください。
「この分析において、」で始めて、2つの定性的な要素を挙げて評価してください。
「反省点として、」で始めて、具体的な改善策を3つ提案してください。
「次のステップとして、」で始めて、問題点の解決策を定量的に示してください。
要点を箇条書きでまとめ、それぞれについて1行で補足説明を追加してください。
ポイントを箇条書きで整理し、それぞれに1行で要約を加えてください。
項目を箇条書きで示し、それぞれについて1行で主要な情報を補足してください。
主要なポイントを箇条書きで挙げ、それぞれについて1行で説明をしてください。
次の点を箇条書きで列挙し、それぞれに1行で補足情報を提供してください。
概要を箇条書きでまとめ、それぞれについて1行で要点を述べてください。
要素を箇条書きで列挙し、それぞれについて1行で要約を加えてください。
項目を取り上げて箇条書きでリストアップし、それぞれに1行で要点を記述してください。
事項を箇条書きで整理し、それぞれについて1行で補足説明を加えてください。
観点から箇条書きで述べ、それぞれに1行で補足情報を提供してください。
事項を考慮して箇条書きでリストアップし、それぞれに1行の説明を加えてください。
観点を踏まえて箇条書きで示し、それぞれについて1行で要点をまとめてください。
ポイントを箇条書きで列挙し、それぞれについて1行の詳細を追加してください。
要素を箇条書きで整理し、それぞれについて1行で簡潔に説明してください。
内容を箇条書きで列挙し、それぞれに1行で要点を記述してください。
各要素を1から5までのスケールで評価し、箇条書きでその結果を示してください。
各要素を5段階の評価スケールで評価し、JSON形式で結果をまとめてください。
1から5の評価スケールを使用して各要素を評価し、YAML形式で結果を出力してください。
各要素を1から5の範囲で評価し、評価結果を箇条書きでリストアップしてください。
評価スケールを使用して、各要素を1から5までで評価し、その結果をJSON形式で示してください。
各要素を5段階で評価し、YAML形式で詳細を記載してください。
1-5の評価基準に基づいて各要素を評価し、その結果を箇条書きで示してください。
各要素を1から5までのスケールで評価し、その評価をJSON形式で整理してください。
各要素を5段階で評価し、YAML形式で結果を一覧にしてください。
1から5の範囲で各要素を評価し、その評価結果を箇条書きで示してください。
5段階の評価スケールを使用して各要素を評価し、その結果をJSON形式で出力してください。
各要素を1-5のスケールで評価し、その結果をYAML形式でまとめてください。
各要素を1から5のスコアで評価し、評価結果を箇条書きでリスト化してください。
1-5の評価スケールに基づいて各要素を評価し、JSON形式で結果を示してください。
各要素を5段階で評価し、その評価結果をYAML形式で記録してください。
各要素を1から10までのスケールで評価し、箇条書きで結果を示してください。
3段階の評価スケールを使用して各要素を評価し、JSON形式で結果をまとめてください。
1から7の評価スケールで各要素を評価し、YAML形式で結果を出力してください。
各要素を1から4の範囲で評価し、評価結果を箇条書きでリストアップしてください。
10段階の評価スケールを使用して各要素を評価し、その結果をJSON形式で示してください。
各要素を1から6のスケールで評価し、YAML形式で詳細を記載してください。
3段階の評価基準に基づいて各要素を評価し、その結果を箇条書きで示してください。
各要素を1から9までのスケールで評価し、その評価をJSON形式で整理してください。
各要素を7段階で評価し、YAML形式で結果を一覧にしてください。
1から8の範囲で各要素を評価し、その評価結果を箇条書きで示してください。
6段階の評価スケールを使用して各要素を評価し、その結果をJSON形式で出力してください。
各要素を1-10のスケールで評価し、その結果をYAML形式でまとめてください。
各要素を1から5のスコアで評価し、評価結果を箇条書きでリスト化してください。
1-7の評価スケールに基づいて各要素を評価し、JSON形式で結果を示してください。
各要素を4段階で評価し、その評価結果をYAML形式で記録してください。
回答の理由を3つ挙げ、それぞれについて簡単に説明してください。
なぜそのように回答したのか、理由を述べてください。
回答の背後にある論拠を明確に示してください。
その回答に至った根拠を説明してください。
その回答を選んだ理由を具体的に説明してください。
なぜその結論に至ったのか、根拠を明確にしてください。
回答の理由を、論理的に説明してください。
その答えを選んだ背景や理由を詳しく述べてください。
回答の背後にある論理的な理由を述べてください。
その結論に達した理由を3つ挙げて説明してください。
なぜそのように考えたのか、理由を明確にしてください。
その答えに至ったプロセスを説明してください。
回答の論拠を3つのポイントで述べてください。
その回答を支持する理由を具体的に述べてください。
その答えを選んだ動機を説明してください。
回答に至った背景を詳しく説明してください。
なぜそのように判断したのか、理由を示してください。
回答の根拠を2つ挙げて説明してください。
その結論を選んだ理由を詳細に述べてください。
なぜその回答を選んだのか、背景を説明してください。
YAML形式で、回答の理由を3つ挙げて説明してください｡
JSON形式で、回答の理由を3つ挙げて説明してください｡
YAML形式で、回答の反論を3つ挙げて説明してください｡
JSON形式で、回答の反論を3つ挙げて説明してください｡
「あ」で始まる文にして、回答の理由を3つ挙げて説明してください｡
「い」で始まる文にして、回答の理由を3つ挙げて説明してください｡
「う」で始まる文にして、回答の理由を3つ挙げて説明してください｡
「え」で始まる文にして、回答の理由を3つ挙げて説明してください｡
「お」で始まる文にして、回答の理由を3つ挙げて説明してください｡
「か」で始まる文にして、回答の理由を3つ挙げて説明してください｡
「き」で始まる文にして、回答の理由を3つ挙げて説明してください｡  
「く」で始まる文にして、回答の理由を3つ挙げて説明してください｡
「け」で始まる文にして、回答の理由を3つ挙げて説明してください｡
「こ」で始まる文にして、回答の理由を3つ挙げて説明してください｡
「さ」で始まる文にして、回答の理由を3つ挙げて説明してください｡
「し」で始まる文にして、回答の理由を3つ挙げて説明してください｡
「す」で始まる文にして、回答の理由を3つ挙げて説明してください｡
「せ」で始まる文にして、回答の理由を3つ挙げて説明してください｡
「そ」で始まる文にして、回答の理由を3つ挙げて説明してください｡
「た」で始まる文にして、回答の理由を3つ挙げて説明してください｡
「ち」で始まる文にして、回答の理由を3つ挙げて説明してください｡
「つ」で始まる文にして、回答の理由を3つ挙げて説明してください｡
「て」で始まる文にして、回答の理由を3つ挙げて説明してください｡
「と」で始まる文にして、回答の理由を3つ挙げて説明してください｡
"""

response_list = response_text.split("\n")
response_list = [i for i in response_list if i != ""]

# %%


while True:
    seed = int(pid)+int(datetime.now().timestamp())
    print("seed: ", seed)
    random.seed(seed)
    parallel_conversations = [{"qid": i, "conversations": []}
                              for i in range(batch_size)]
    for turn_id in range(n_turns):
        print("turn_id", turn_id)
        # はじめのターンはランダムな質問
        if turn_id == 0:
            prompt_list = []
            for qid in range(len(parallel_conversations)):
                job = random.choice(job_list)
                character = random.choice(character_list)
                role = f"あなたは{job}です。{character}性格です。"
                genre = random.choice(genre_list)+","+random.choice(genre_list)
                command = f"{genre}に関する指示や質問を一つだけしてください。質問や指示のみを出力し､それ以外は何も含めないこと"
                prompt_list.append(question_to_prompt(command, role))
            print(prompt_list[:3])
            question_list = llm_gen(llm, prompt_list)
        else:
            # 2ターン目では固定された質問を使う
            question_list = random.sample(response_list, batch_size)

        # 解答する
        prompt_list = []
        for qid in range(len(parallel_conversations)):
            character = random.choice(character_list)
            role = f"あなたはアシスタントです。{character}性格です。"
            command = f"次の質問に日本語で回答しなさい｡"
            prompt_list.append(question_to_prompt(
                question_list[qid], role, parallel_conversations[qid]["conversations"]))
        answer_list = llm_gen(llm, prompt_list, temperature=0.01, top_k=1)

        for qid in range(len(parallel_conversations)):
            parallel_conversations[qid]["conversations"].append(
                (question_list[qid], answer_list[qid]))

    # 書き出し
    for record in parallel_conversations:
        conversation_list = []
        text = ""
        remove_flag = False
        for q, a in record["conversations"]:

            # 長すぎるものは削除(壊れた出力)
            if get_longest_phrase_length(q) > 100 or get_longest_phrase_length(a) > 100:
                remove_flag = True
                break
            if is_abnormal_text(q) or is_abnormal_text(a):
                remove_flag = True
                break

            text += f"""user: {q} assistant: {a}\n"""
            # conversation_list.append({"role":"user","content":q})
            # conversation_list.append({"role":"assistant","content":q})
        text = text.strip()
        record["text"] = text
        # record["messages"]=text
        if text == "":
            continue

        record.pop("conversations")

        with open(out_path, "a") as f:
            f.write(json.dumps(record, ensure_ascii=False) + "\n")
